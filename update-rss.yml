# .github/workflows/update-rss.yml
name: ðŸ“¡ Generate OpenAlex RSS (Debug Mode)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: ðŸ›Žï¸ Checkout
        uses: actions/checkout@v4

      - name: ðŸ§ª Debug: Show current dir & files
        run: |
          pwd
          ls -la
          echo "Git status:"
          git status

      - name: ðŸ“ Create rss/ and test.xml (shell-only, no Python)
        run: |
          # Absolute path safety
          RSS_DIR="$PWD/rss"
          mkdir -p "$RSS_DIR"
          echo "âœ… rss/ created at: $RSS_DIR"

          # Write minimal valid RSS
          cat > "$RSS_DIR/test.xml" << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
  <channel>
    <title>ðŸš€ SUCCESS: OpenAlex RSS Pipeline</title>
    <link>https://openalex.org</link>
    <description>Data from OpenAlex (CC0). Generated via GitHub Actions.</description>
    <item>
      <title>âœ… Your workflow works!</title>
      <link>https://github.com/${{ github.repository }}</link>
      <description><![CDATA[<p>Congratulations â€” your ethical OpenAlex RSS feed is ready to scale.</p>]]></description>
    </item>
  </channel>
</rss>
EOF

          # Verify file exists
          ls -la "$RSS_DIR"
          echo "File size: $(wc -c < "$RSS_DIR/test.xml") bytes"

      - name: ðŸ“¤ Commit to GitHub
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          
          # Stage exactly this file
          git add rss/test.xml
          
          # Commit unconditionally (force)
          git commit -m "ðŸ¤– RSS: test.xml" --allow-empty
          git push
          
          echo "âœ… Push completed. Check repo for rss/test.xml"
